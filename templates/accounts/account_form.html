{% load static %}
{% extends 'base_dashboard.html' %}

{% block dashboard_title %}{% if object %}Editar Conta{% else %}Nova Conta{% endif %}{% endblock %}

{% block dashboard_content %}
<!-- Page Header -->
<div class="mb-8">
    <div class="flex items-center space-x-3 mb-2">
        <a href="{% url 'accounts:list' %}" class="text-slate-400 hover:text-slate-100 transition-colors duration-200">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg>
        </a>
        <h1 class="text-3xl font-bold text-slate-100">{% if object %}Editar Conta{% else %}Nova Conta{% endif %}</h1>
    </div>
    <p class="text-slate-400">{% if object %}Atualize as informações da sua conta bancária{% else %}Cadastre uma nova conta bancária para gerenciar suas finanças{% endif %}</p>
</div>

<!-- Form Card -->
<div class="max-w-3xl">
    <form method="post" class="bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-8">
        {% csrf_token %}

        <!-- Display non-field errors -->
        {% if form.non_field_errors %}
        <div class="bg-red-900/30 border border-red-700 rounded-lg p-4 flex items-start mb-6">
            <svg class="w-5 h-5 text-red-400 mr-3 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>
            <div>
                {% for error in form.non_field_errors %}
                <p class="text-red-100">{{ error }}</p>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Account Information Section -->
        <div class="mb-8">
            <h2 class="text-xl font-bold text-slate-100 mb-6">Informações da Conta</h2>

            <!-- Name Field -->
            <div class="mb-6">
                <label for="{{ form.name.id_for_label }}" class="block text-sm font-medium text-slate-100 mb-2">
                    Nome da Conta <span class="text-red-400">*</span>
                </label>
                <input type="text"
                       name="{{ form.name.name }}"
                       id="{{ form.name.id_for_label }}"
                       value="{{ form.name.value|default:'' }}"
                       class="w-full px-4 py-3 bg-slate-900 border {% if form.name.errors %}border-red-500{% else %}border-slate-700{% endif %} rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent transition-all duration-200"
                       placeholder="Ex: Conta Corrente Principal"
                       required>
                {% if form.name.errors %}
                <div class="mt-2">
                    {% for error in form.name.errors %}
                    <p class="text-sm text-red-400 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                        </svg>
                        {{ error }}
                    </p>
                    {% endfor %}
                </div>
                {% endif %}
                {% if form.name.help_text %}
                <p class="text-xs text-slate-400 mt-1">{{ form.name.help_text }}</p>
                {% endif %}
            </div>

            <!-- Two Column Grid for Type and Bank -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Account Type Field -->
                <div>
                    <label for="{{ form.account_type.id_for_label }}" class="block text-sm font-medium text-slate-100 mb-2">
                        Tipo de Conta <span class="text-red-400">*</span>
                    </label>
                    <select name="{{ form.account_type.name }}"
                            id="{{ form.account_type.id_for_label }}"
                            class="w-full px-4 py-3 bg-slate-900 border {% if form.account_type.errors %}border-red-500{% else %}border-slate-700{% endif %} rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent transition-all duration-200"
                            required>
                        <option value="">Selecione o tipo</option>
                        {% for value, label in form.account_type.field.choices %}
                        {% if value %}
                        <option value="{{ value }}" {% if form.account_type.value == value %}selected{% endif %}>{{ label }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                    {% if form.account_type.errors %}
                    <div class="mt-2">
                        {% for error in form.account_type.errors %}
                        <p class="text-sm text-red-400 flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                            </svg>
                            {{ error }}
                        </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if form.account_type.help_text %}
                    <p class="text-xs text-slate-400 mt-1">{{ form.account_type.help_text }}</p>
                    {% endif %}
                </div>

                <!-- Bank Field -->
                <div>
                    <label for="{{ form.bank.id_for_label }}" class="block text-sm font-medium text-slate-100 mb-2">
                        Banco
                    </label>
                    <input type="text"
                           name="{{ form.bank.name }}"
                           id="{{ form.bank.id_for_label }}"
                           value="{{ form.bank.value|default:'' }}"
                           class="w-full px-4 py-3 bg-slate-900 border {% if form.bank.errors %}border-red-500{% else %}border-slate-700{% endif %} rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent transition-all duration-200"
                           placeholder="Ex: Banco do Brasil">
                    {% if form.bank.errors %}
                    <div class="mt-2">
                        {% for error in form.bank.errors %}
                        <p class="text-sm text-red-400 flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                            </svg>
                            {{ error }}
                        </p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if form.bank.help_text %}
                    <p class="text-xs text-slate-400 mt-1">{{ form.bank.help_text }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Initial Balance Field -->
            <div>
                <label for="{{ form.initial_balance.id_for_label }}" class="block text-sm font-medium text-slate-100 mb-2">
                    Saldo Inicial <span class="text-red-400">*</span>
                </label>
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-mono">R$</span>
                    <input type="number"
                           name="{{ form.initial_balance.name }}"
                           id="{{ form.initial_balance.id_for_label }}"
                           value="{{ form.initial_balance.value|default:'' }}"
                           step="0.01"
                           class="w-full pl-12 pr-4 py-3 bg-slate-900 border {% if form.initial_balance.errors %}border-red-500{% else %}border-slate-700{% endif %} rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent transition-all duration-200 font-mono"
                           placeholder="0.00"
                           required>
                </div>
                {% if form.initial_balance.errors %}
                <div class="mt-2">
                    {% for error in form.initial_balance.errors %}
                    <p class="text-sm text-red-400 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                        </svg>
                        {{ error }}
                    </p>
                    {% endfor %}
                </div>
                {% endif %}
                {% if form.initial_balance.help_text %}
                <p class="text-xs text-slate-400 mt-1">{{ form.initial_balance.help_text }}</p>
                {% else %}
                <p class="text-xs text-slate-400 mt-1">Informe o saldo atual da conta. Use ponto como separador decimal.</p>
                {% endif %}
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-slate-700">
            <button type="submit"
                    class="px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                {% if object %}Salvar Alterações{% else %}Criar Conta{% endif %}
            </button>
            <a href="{% url 'accounts:list' %}"
               class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-slate-100 font-medium rounded-lg border border-slate-600 transition-all duration-200 flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
                Cancelar
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="{% static 'js/accounts.js' %}"></script>
{% endblock %}
