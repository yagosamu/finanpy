!function(){"use strict";const e={typeSelect:null,categorySelect:null,categoriesData:[],init(){if(this.typeSelect=document.getElementById("id_transaction_type"),this.categorySelect=document.getElementById("id_category"),!this.typeSelect||!this.categorySelect)return;const e=this.categorySelect.dataset.categories;if(e)try{this.categoriesData=JSON.parse(e)}catch(e){return void console.warn("Failed to parse categories data:",e)}this.selectedCategoryId=this.categorySelect.value,this.typeSelect.addEventListener("change",()=>{this.filterCategories()}),this.filterCategories()},filterCategories(){const e=this.typeSelect.value,t=this.categorySelect.value;for(;this.categorySelect.options.length>1;)this.categorySelect.remove(1);const a=e?this.categoriesData.filter(t=>t.type===e):this.categoriesData;a.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,t.dataset.color=e.color,t.dataset.type=e.type,this.categorySelect.appendChild(t)});if(a.find(e=>String(e.id)===String(t)))this.categorySelect.value=t;else if(this.selectedCategoryId){a.find(e=>String(e.id)===String(this.selectedCategoryId))&&(this.categorySelect.value=this.selectedCategoryId,this.selectedCategoryId=null)}}},t={input:null,init(e){if(!e)return;if(this.input=e,e.type="text",e.removeAttribute("step"),e.removeAttribute("min"),e.placeholder="0,00",e.classList.add("currency-input"),e.value){const t=parseFloat(e.value);!isNaN(t)&&t>0&&(e.value=this.format(t))}e.addEventListener("input",e=>this.handleInput(e)),e.addEventListener("blur",e=>this.handleBlur(e));const t=e.closest("form");t&&t.addEventListener("submit",()=>{const a=this.parse(e.value),n=document.createElement("input");n.type="hidden",n.name=e.name,n.value=a,e.disabled=!0,t.appendChild(n)})},format:e=>e||0===e?e.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):"",parse(e){if(!e)return 0;const t=e.replace(/\./g,"").replace(",","."),a=parseFloat(t);return isNaN(a)?0:a},handleInput(e){const t=e.target.selectionStart,a=e.target.value;let n=a.replace(/[^\d,]/g,"");const r=n.split(",");if(r.length>2&&(n=r[0]+","+r.slice(1).join("")),r[1]&&r[1].length>2&&(n=r[0]+","+r[1].substring(0,2)),n){const[e,t]=n.split(","),a=e.replace(/\B(?=(\d{3})+(?!\d))/g,".");n=void 0!==t?`${a},${t}`:a}e.target.value=n;const o=t+(n.length-a.length);e.target.setSelectionRange(o,o)},handleBlur(e){const t=e.target.value;if(t){const a=this.parse(t);a>0&&(e.target.value=this.format(a))}}},a={init(e){if(!e)return;const t=e.querySelector("#id_transaction_type"),a=e.querySelector("#id_amount"),n=e.querySelector("#id_date"),r=e.querySelector("#id_account"),o=e.querySelector("#id_category");a&&(a.addEventListener("blur",()=>this.validateAmount(a)),a.addEventListener("input",()=>this.clearError(a))),n&&(n.addEventListener("blur",()=>this.validateDate(n)),n.addEventListener("change",()=>this.clearError(n))),e.addEventListener("submit",e=>{let s=!0;t&&!t.value&&(this.showError(t,"Selecione o tipo da transação."),s=!1),a&&!this.validateAmount(a)&&(s=!1),n&&!this.validateDate(n)&&(s=!1),r&&!r.value&&(this.showError(r,"Selecione uma conta."),s=!1),o&&!o.value&&(this.showError(o,"Selecione uma categoria."),s=!1),s||e.preventDefault()})},validateAmount(e){const a=e.classList.contains("currency-input")?t.parse(e.value):parseFloat(e.value);return e.value.trim()?isNaN(a)||a<=0?(this.showError(e,"O valor deve ser maior que zero."),!1):a>99999999.99?(this.showError(e,"O valor não pode ser maior que R$ 99.999.999,99."),!1):(this.showSuccess(e),!0):(this.showError(e,"O valor é obrigatório."),!1)},validateDate(e){if(!e.value)return this.showError(e,"A data é obrigatória."),!1;const t=new Date(e.value+"T00:00:00"),a=new Date;return a.setHours(0,0,0,0),t>a?(this.showError(e,"A data não pode ser no futuro."),!1):(this.showSuccess(e),!0)},showSuccess(e){this.clearError(e),e.classList.add("border-green-500")},showError(e,t){this.clearError(e),e.classList.add("border-red-500");const a=document.createElement("div");a.className="field-error mt-2",a.innerHTML=`\n        <p class="text-sm text-red-400 flex items-center">\n          <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">\n            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />\n          </svg>\n          ${t}\n        </p>\n      `;(e.closest(".relative")||e.parentElement).appendChild(a)},clearError(e){e.classList.remove("border-red-500","border-green-500");const t=(e.closest(".relative")||e.parentElement).querySelector(".field-error");t&&t.remove()}},n={modal:null,init(){this.modal||(this.modal=document.createElement("div"),this.modal.id="transaction-delete-modal",this.modal.className="fixed inset-0 z-50 hidden",this.modal.innerHTML='\n        \x3c!-- Backdrop --\x3e\n        <div class="fixed inset-0 bg-black/70 backdrop-blur-sm transition-opacity" onclick="TransactionDeleteModal.close()"></div>\n\n        \x3c!-- Modal Content --\x3e\n        <div class="fixed inset-0 flex items-center justify-center p-4">\n          <div class="bg-slate-800 rounded-xl shadow-2xl border border-red-600/30 max-w-md w-full transform transition-all scale-95 opacity-0" id="transaction-delete-modal-content">\n            \x3c!-- Icon --\x3e\n            <div class="flex items-center justify-center w-16 h-16 mx-auto mt-8 bg-red-900/30 rounded-full">\n              <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>\n              </svg>\n            </div>\n\n            \x3c!-- Content --\x3e\n            <div class="p-8 text-center">\n              <h3 class="text-2xl font-bold text-slate-100 mb-3">Excluir Transação</h3>\n              <p class="text-slate-300 mb-2" id="transaction-delete-modal-message">\n                Tem certeza que deseja excluir esta transação?\n              </p>\n              <p class="text-slate-400 text-sm">\n                O saldo da conta será ajustado automaticamente.\n              </p>\n            </div>\n\n            \x3c!-- Actions --\x3e\n            <div class="flex gap-3 px-8 pb-8">\n              <button type="button"\n                      onclick="TransactionDeleteModal.close()"\n                      class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-slate-100 font-medium rounded-lg border border-slate-600 transition-all duration-200">\n                Cancelar\n              </button>\n              <button type="button"\n                      id="transaction-delete-modal-confirm"\n                      class="flex-1 px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200">\n                Excluir\n              </button>\n            </div>\n          </div>\n        </div>\n      ',document.body.appendChild(this.modal),document.addEventListener("keydown",e=>{"Escape"!==e.key||this.modal.classList.contains("hidden")||this.close()}))},show(e,t){this.init();const a=document.getElementById("transaction-delete-modal-message");a&&e&&(a.textContent=`Tem certeza que deseja excluir "${e}"?`);const n=document.getElementById("transaction-delete-modal-confirm"),r=n.cloneNode(!0);n.parentNode.replaceChild(r,n),r.addEventListener("click",()=>{t&&t(),this.close()}),this.modal.classList.remove("hidden"),setTimeout(()=>{const e=document.getElementById("transaction-delete-modal-content");e.classList.remove("scale-95","opacity-0"),e.classList.add("scale-100","opacity-100")},10)},close(){const e=document.getElementById("transaction-delete-modal-content");e&&(e.classList.add("scale-95","opacity-0"),e.classList.remove("scale-100","opacity-100")),setTimeout(()=>{this.modal&&this.modal.classList.add("hidden")},200)}},r={format(e){if(!e&&0!==e)return"0,00";const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0,00":t.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},init(){document.querySelectorAll("[data-currency]").forEach(e=>{const t=parseFloat(e.dataset.currency);if(!isNaN(t)){const a=e.dataset.currencyPrefix||"";e.textContent=a+"R$ "+this.format(t)}})}};document.addEventListener("DOMContentLoaded",()=>{e.init();const o=document.getElementById("id_amount");o&&t.init(o);const s=document.querySelector('form[method="post"]');s&&a.init(s),r.init();document.querySelectorAll('a[href*="/excluir/"]').forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const a=e.closest("tr")||e.closest("[data-transaction]"),r=a?.querySelector(".transaction-description")?.textContent||"esta transação";n.show(r.trim(),()=>{window.location.href=e.href})})})}),window.CategoryFilter=e,window.CurrencyMask=t,window.CurrencyDisplay=r,window.TransactionFormValidator=a,window.TransactionDeleteModal=n}();